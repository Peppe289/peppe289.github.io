<!DOCTYPE html>
<html>

<head>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="author" content="Peppe289">
    <meta property="og:title" content="Giuseppe Speranza">
    <meta name="description" content="Messaggio Anonimo">
    <meta property="og:site_name" content="Peppe289">

    <link rel="stylesheet" type="text/css" href="resource/css/toggle.css" />
    <link rel="stylesheet" type="text/css" href="resource/css/animation.css" />
    <link rel="stylesheet" type="text/css" href="resource/css/style.css" />
    <link rel="stylesheet" type="text/css" href="resource/css/sidebar.css" />
    <link rel="stylesheet" type="text/css" href="resource/css/flip-card.css" />
    <link rel="stylesheet" type="text/css" href="resource/css/feature-card.css" />
    <link rel="stylesheet" type="text/css" href="resource/css/button.css" />
    <title>Messaggio Anonimo</title>
</head>

<body>
    <div id="navbar">
        <div id="navMenu">
            <span></span>
            <span></span>
            <span></span>
        </div>
    </div>
    <!-- side bar -->
    <div id="sidebar" class="link-ref">
        <h3>Informazioni sul sito</h3>
        <p>Developed by me with ❤️</p>
        <p>Source of this on my <a style="color: white;"
                href="https://github.com/Peppe289/peppe289.github.io/">GitHub</a></p>
        <a href="https://www.instagram.com/gsperanza204/">
            <img class="blob" src="https://upload.wikimedia.org/wikipedia/commons/e/e7/Instagram_logo_2016.svg"></a>
        <a href="https://t.me/Peppe289">
            <img class="blob" src="https://web.telegram.org/z/icon-192x192.png"></a>
        <a href="https://peppe289.github.io/"><img class="blob" style="border-radius: 10px;"  src="img/personal.ico.jpg"></a>
    </div>

    <div class="main">
        <h1>Inviami un messaggio anonimo!</h1>
        <p>Questo sistema si avvale delle API telegram (non ti serverà disporre di un account telegram). Il messaggio
            sarà completamente anonimo.</p>
        <div class="form-group">
            <input type="text" id="name" name="name" placeholder="Nome" autocomplete="off" />
            <input text="text" id="messaggio" name="messaggio" placeholder="Messaggio" autocomplete="off" />
        </div>
        <button class="style-btn" id="invia-messaggio" onclick="execute()"
            style="border: none; margin-left: 2%; margin-right: 2%;">Invia</button>
        <div id="response" style="margin: 2%">
            <!-- debug per l'invio del messaggio -->
        </div>
    </div>
</body>
<script>
    const token = '<token>';
    const chatId = '-1001441002138';

    function execute() {
        const fname = document.querySelector('#name').value;
        const msg = document.querySelector('#messaggio').value;
        const isBrowser = navigator.userAgent.toLowerCase();
        const message = `Mittente: ${fname}\nMessaggio: ${msg}\n\nFrom:\n${isBrowser}`;

        if (msg == "") {
            $('#response').text('Il campo "Messaggio" non può essere vuoto');
            return;
        }

        $('#response').text('Invio in corso!');

        $.ajax({
            type: 'POST',
            url: `https://api.telegram.org/bot${token}/sendMessage`,
            data: {
                chat_id: chatId,
                text: message,
                parse_mode: 'html',
            },
            success: function (res) {
                console.debug(res);
                $('#response').text('Messaggio inviato!');
            },
            error: function (error) {
                console.error(error);
                $('#response').text('Messaggio non inviato!');
            }
        });
    }
</script>
<script src="resource/js/toggle.js"></script>
<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>

</html>